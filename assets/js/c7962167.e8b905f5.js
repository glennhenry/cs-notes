"use strict";(self.webpackChunkcs_notes=self.webpackChunkcs_notes||[]).push([[261],{46192:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>l});var a=t(85893),i=t(11151);const s={slug:"/database-system/logging-and-recovery",id:"logging-and-recovery",title:"Logging & Recovery",description:"Logging & Recovery"},r=void 0,o={id:"database-system/logging-and-recovery/logging-and-recovery",title:"Logging & Recovery",description:"Logging & Recovery",source:"@site/docs/database-system/08-logging-and-recovery/logging-and-recovery.md",sourceDirName:"database-system/08-logging-and-recovery",slug:"/database-system/logging-and-recovery",permalink:"/cs-notes/database-system/logging-and-recovery",draft:!1,unlisted:!1,editUrl:"https://github.com/glennhenry/cs-notes/tree/main/docs/database-system/08-logging-and-recovery/logging-and-recovery.md",tags:[],version:"current",lastUpdatedBy:"glennhenry",lastUpdatedAt:1710169101,formattedLastUpdatedAt:"Mar 11, 2024",frontMatter:{slug:"/database-system/logging-and-recovery",id:"logging-and-recovery",title:"Logging & Recovery",description:"Logging & Recovery"},sidebar:"sidebar",previous:{title:"Trigger & Constraints",permalink:"/cs-notes/database-system/trigger-and-constraints"},next:{title:"Database Index",permalink:"/cs-notes/database-system/database-index"}},c={},l=[{value:"Logging",id:"logging",level:3},{value:"Transaction Log",id:"transaction-log",level:4},{value:"Replication",id:"replication",level:3},{value:"RAID",id:"raid",level:4},{value:"Migration",id:"migration",level:3}];function d(e){const n={a:"a",br:"br",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Main Source :"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Logging_(computing)",children:"Logging (computing) - Wikipedia"})})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Transaction_log",children:"Transaction log - Wikipedia"})})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Write-ahead_logging",children:"Write-ahead logging - Wikipedia"})})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Replication_(computing)",children:"Replication (computing) - Wikipedia"})})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Schema_migration",children:"Schema migration - Wikipedia"})})}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"logging",children:"Logging"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Logging"})," is the process of recording activities and changes that occur within a computer system. A log can be a problem, error, or just information on current operations."]}),"\n",(0,a.jsx)(n.h4,{id:"transaction-log",children:"Transaction Log"}),"\n",(0,a.jsxs)(n.p,{children:["Database operations are grouped into a unit of ",(0,a.jsx)(n.a,{href:"/database-system/transactions",children:"transaction"}),". Transaction log is the log file that contains all the transactions and changes made to the database over time."]}),"\n",(0,a.jsx)(n.p,{children:"Keeping track of database operation can be helpful to maintain data integrity. In the case of system failures, the DBMS can review the log and rolls back the state of database to a consistent state. By replaying the logged transactions, the system can reapply the changes made by committed transactions or undo the changes made by uncommitted or rolled-back transactions."}),"\n",(0,a.jsxs)(n.p,{children:["Database logs are linked together, forming a ",(0,a.jsx)(n.a,{href:"/data-structures-and-algorithms/linked-list",children:"linked list"}),". A log record is made up of :"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Log Sequence Number (LSN)"})," : LSN is a unique ID of a log record, it is assigned to each transaction record."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Prev LSN"})," : A reference to the previous log record in the linked list structure of the log."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Transaction ID"})," : The associated transaction of a log record."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Type"})," : Type of database log record.","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Update"})," : It can be an update or change to database, it will include a reference to the modified page, length and offset of the page, and size of the page before and after the update."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Compensation"})," : A log about rollback of particular changes to the database. Each record is associated with the update log record, it also includes the next log record that needs to be undone for the transaction that wrote the last update log record."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Commit"})," : A decision to commit a transaction, which is a successful completion of a transaction."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Abort"})," : The decision to abort and rollback a transaction"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Checkpoint"})," Changes made in the memory is called ",(0,a.jsx)(n.strong,{children:"dirty pages"}),", a checkpoint is when all the dirty pages has been flushed or written to disk. The checkpoint record contains :","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"redo LSN : Reference for first update after checkpoint, it is the starting point of redo on recovery."}),"\n",(0,a.jsx)(n.li,{children:"undo LSN : Reference to starting point for undoing the changes made by that transaction."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Completion"})," : Information about all work that has been done, either aborted or committed, for a particular transaction."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Actual Information"})," : Contains the necessary information to describe the changes made by the transaction that causes the log to be written."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.img,{alt:"Transaction log",src:t(2392).Z+"",width:"401",height:"350"}),(0,a.jsx)(n.br,{}),"\n","Source : ",(0,a.jsx)(n.a,{href:"https://sqlbak.com/academy/transaction-log/",children:"https://sqlbak.com/academy/transaction-log/"})]}),"\n",(0,a.jsxs)(n.p,{children:["During logging transaction, it can be implemented using the ",(0,a.jsx)(n.strong,{children:"write-ahead logging (WAL)"})," technique. This technique write changes to the database to a log file, along with undo and redo information, before they are applied to the actual data pages on disk."]}),"\n",(0,a.jsx)(n.p,{children:"The transaction and logging usually happens periodically. Transaction are written to the log, after some point, the system will perform a checkpoint, writing all the changes to the database and clear the logs."}),"\n",(0,a.jsx)(n.h3,{id:"replication",children:"Replication"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Replication"})," is the process of maintaining a copy of data for fault-tolerance."]}),"\n",(0,a.jsx)(n.p,{children:"Key concept of data replication :"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Replicated data can be stored in the same device or distributed in multiple device."}),"\n",(0,a.jsx)(n.li,{children:"Replicated data can be all or some subset of the data."}),"\n",(0,a.jsx)(n.li,{children:"Replica is typically updated frequently."}),"\n",(0,a.jsx)(n.li,{children:"To synchronize with modification, we can either modify the primary and replicas simultaneously, or modify the primary data first and all the replicas after."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Some techniques of replication :"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Master-Slave Replication"})," : In this approach, there is a single master database that handles write operations, while one or more slave databases replicate the data from the master. The slaves are read-only replicas, they can only serve read queries from clients. The master propagates the changes to the slaves asynchronously or synchronously in some amount of time."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Multi-Master Replication"})," : In this approach, multiple database instances function as both masters and slaves. Each master can handle write operations independently, and changes made on one master are replicated to the other masters."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Multi-Level Replication"})," : This approach creates a hierarchy of replicas, where changes are propagated through multiple levels of replication. For example, changes made to a primary database are replicated to secondary replicas, which in turn replicate the data to tertiary replicas."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"It is common for conflict to occurs in multi-master replication. One way to resolve conflict is to abort and rollback based on timestamp of when the transaction was done."}),"\n",(0,a.jsx)(n.h4,{id:"raid",children:"RAID"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"RAID"})," is a fault-tolerance technique that involve creating redundancy in computer storage by distributing data across multiple disks."]}),"\n",(0,a.jsxs)(n.p,{children:["See ",(0,a.jsx)(n.a,{href:"/operating-system/disk-management#raid",children:"RAID"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"migration",children:"Migration"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Migration"})," is the process of moving or transferring a database from one system or environment to another. Database migration transfer data, schema, and associated objects from the source system to the target system while ensuring data integrity and compatibility."]}),"\n",(0,a.jsx)(n.p,{children:"A migration is needed when a specific changes applied to a database alters its structure. Some scenarios are :"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Schema Changes"})," : When modifying the structure of a database, such as adding, modifying, or removing tables, columns, indexes, or constraints."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Data Transformations"}),": This may include data conversions, normalization, denormalization, etc."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Version Upgrades"})," : When upgrading the DBMS to a newer version, a migration is often required to ensure compatibility with the new database software."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"System Upgrades"})," : Scenario of system upgrades, or when moving data to a different platform, such as migrating from an on-premises database to a cloud-based solution."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},2392:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/transaction-log-3219ffce5427c266c6265cae9fe6784c.png"},11151:(e,n,t)=>{t.d(n,{Z:()=>o,a:()=>r});var a=t(67294);const i={},s=a.createContext(i);function r(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);